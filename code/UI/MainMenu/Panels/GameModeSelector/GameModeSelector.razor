@using Sandbox;
@using Sandbox.UI;
@inherits Panel

<root>
    <DropDown @ref="DropDown" onclick=@OnClick ValueChanged="@OnValueChange" />
</root>

@code
{
    DropDown DropDown;

    public bool IsDropDownOpen { get; set; } = false;

	protected override void OnAfterTreeRender(bool firstTime)
	{
		if (firstTime)
		{
			var options = ResourceLibrary.GetAll<GameModeResource>().Where( x => !x.Hidden ).Select( x => new Option() { Title = x.Title, Value = x } ).ToList();
			DropDown.Options = options;
			DropDown.Selected = options.FirstOrDefault( x => x.Title == GameModeType.Classic.ToString() );
		}

		base.OnAfterTreeRender(firstTime);
	}

	void OnValueChange( string value )
	{
		GameSystem.SetGameMode( (GameModeResource)DropDown.Selected.Value );
	}

	void OnClick()
	{
		if ( IsDropDownOpen )
		{
			Sandbox.UI.Popup.CloseAll();
			IsDropDownOpen = false;
		}
		else
		{
			IsDropDownOpen = true;
		}
	}
}
